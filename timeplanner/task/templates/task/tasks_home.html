{% extends "base.html" %}
{% load static i18n %}

{% block content %}
  {{ block.super }}

{% for node in expanded_tasks %}
  <div class="list-group-item nested-1 task" id="tasks">
      {% include 'task/components/tasknode.html' with node=node %}
    </div>
    {% empty %}
      No tasks!
    {% endfor %}

{% endblock content %}



{% block javascript %}
  {{ block.super }}
  <script src="{% static 'js/sortable.min.js' %}" crossorigin="anonymous"></script>

  <script>

    // Nested demo
    var nestedSortables = document.getElementsByClassName('task');

    // Loop through each nested sortable element
    for (var i = 0; i < nestedSortables.length; i++) {
      new Sortable(nestedSortables[i], {
        group: 'nested',
        animation: 150,
        fallbackOnBody: true,
        swapThreshold: 0.65,
        onStart: function () {
          // Save order before sort
          this._currentOrder = this.toArray();

        },
        onUpdate: function (e, group) {
          // Disabling sorting
          this.option('disabled', true);

          // Adding effect
          this.el.classList.add('pulsate');
          console.log(e, group)
          let sorter = this;

          $.ajax({
            url: '',
            data: {
              'username': 'agu'
            },
            dataType: 'json',
            success: function (data) {
              if (data.is_taken) {
                alert("A user with this username already exists.");
              }
            },
            fail: function () {
              alert('Fail, revert order');
              this.sort(this._currentOrder);
            },
            always: function () {
              sorter.option('disabled', false);
              sorter.el.classList.remove('pulsate');
            }
          });

        }
      });
    }
  </script>
{% endblock %}
